---
title: "presentation-actual"
format: revealjs
editor: visual
---

```{r load-packages, echo=FALSE, message=FALSE}
library(tidyverse)
library(dplyr)
library(tidytuesdayR)
library(lubridate)
library(readr)
library(ggpattern)
library(scales)
```

```{r bullets, echo=FALSE}
# Source for our bullet structure in this presentation: https://stackoverflow.com/questions/49084904/r-markdown-bullet-list-with-multiple-levels
```


## The Hypocrisy of US Corporate Pride and Anti-LGBTQ+ Donations {background-color = "lightgray"}

## Data

## Abstract

## Question 1 {background-color = "lightgray"}

## Plot 1

```{r data-processing-plot-1, echo=FALSE}
#| label: data_processing_plot_1

static_list <- static_list %>%
  mutate(
    amount_contributed = `Amount Contributed Across States`,
    hrc_pledge = `HRC Business Pledge`,
    pride_or_not = `Pride?`
  )

new_static_list <- static_list %>%
  filter(!is.na(Company), !is.na(hrc_pledge)) %>%
  select(Company, amount_contributed, hrc_pledge, pride_or_not) %>%
  group_by(Company) %>%
  summarise(
    total_amount = sum(amount_contributed),
    hrc_pledge, pride_or_not
  ) %>%
  arrange(desc(total_amount)) %>%
  slice_head(n = 20)
```

```{r question1-plot-1, echo=FALSE}
#| label: question 1 plot 1

new_static_list %>%
  mutate(
    hrc_pledge = if_else(hrc_pledge == FALSE, "No", "Yes"),
    pride_or_not = if_else(pride_or_not == FALSE, "No", "Yes")
  ) %>%
  ggplot(aes(x = reorder(Company,total_amount), y = total_amount, fill = pride_or_not, pattern = hrc_pledge)) +
  geom_col_pattern(pattern_fill = "darkgray", pattern_color = "darkgray", aes(color = pride_or_not), width = .7) +
  scale_color_manual(values = c("#AA4A44", "lightgrey"), guide = "none") +
  scale_fill_manual(values = c("#AA4A44", "lightgrey")) +
  scale_pattern_manual(values = c("none", "stripe"), guide = guide_legend(override.aes = list(fill = "white", color = "darkgray"))) +
  scale_y_continuous(label = scales::label_dollar()) +
  coord_flip() +
  labs(
    title = "USD Amounts of top 20 companies in contributions \nto anti-LGBTQ+ campaigns",
    x = "Company",
    y = "Amount contributed to anti-LGBTQ+ campaigns (in USD)",
    fill = "Does the company \ndonate to Pride?",
    pattern = "Does the company \nhave an HRC pledge?"
  ) +
  theme_minimal() +
  theme(
    legend.position = c(.85, .32),
    legend.title = element_text(size = 8),
    legend.background = element_rect(fill = "white", color = "darkgrey")
  )
```

## Plot 1 Approach

## Plot 1 Discussion

## Plot 1 Limitations and Future Study

## Plot 2

```{r question1-plot-2-data, echo=FALSE}
company_categ_counts <- static_list %>%
  mutate(
    category = case_when(
      hrc_pledge == TRUE &
        pride_or_not == TRUE ~ "HRC Pledge, donates to Pride",
      hrc_pledge == FALSE &
        pride_or_not == TRUE ~ "No HRC pledge, donates to Pride",
      hrc_pledge == TRUE &
        pride_or_not == FALSE ~ "HRC Pledge, no donation to Pride",
      TRUE ~ "Neither"
    ),
    category = fct_relevel(factor(
      category,
      levels = c(
        "HRC Pledge, donates to Pride",
        "No HRC pledge, donates to Pride",
        "HRC Pledge, no donation to Pride",
        "Neither"
      )
    ))
  ) %>%
  count(category)
```

```{r question1-plot-2, echo=FALSE, warning=FALSE}
#| label: question 1 plot 2
#| warning: false

static_list %>%
  mutate(
    category = case_when(
      hrc_pledge == TRUE &
        pride_or_not == TRUE ~ "HRC Pledge, donates to Pride",
      hrc_pledge == FALSE &
        pride_or_not == TRUE ~ "No HRC pledge, donates to Pride",
      hrc_pledge == TRUE &
        pride_or_not == FALSE ~ "HRC Pledge, no donation to Pride",
      TRUE ~ "Neither"
    ),
    category = fct_relevel(factor(
      category,
      levels = c(
        "HRC Pledge, donates to Pride",
        "No HRC pledge, donates to Pride",
        "HRC Pledge, no donation to Pride",
        "Neither"
      )
    ))
  ) %>%
  ggplot(aes(x = amount_contributed)) +
  geom_density(aes(fill = category, color = category), show.legend = FALSE) +
  scale_x_continuous(label = scales::label_dollar()) +
  scale_y_continuous(labels = label_number()) + # idk if scientific notation is better
  scale_fill_manual(values = c("#AA4A44", "#BF8F8C", "grey", "#899499")) +
  scale_color_manual(values = c("#AA4A44", "#BF8F8C", "grey", "#899499")) + # can take this out
  facet_wrap(~ category, ncol = 1) +
  coord_cartesian(xlim = c(0, 700000)) +
  labs(
    title = "Density of company contributions to anti-LGBTQ+ campaigns",
    subtitle = "Faceted by company characteristics",
    # CHANGE TITLE
    x = "Amount contributed (in USD)",
    y = "Density"
  ) +
  theme_minimal() +
  geom_text(data = company_categ_counts,
            aes(
              x = 680000,
              y = 0.000004,
              label = paste0("n = ", company_categ_counts$n),
            ),
            size = 2.6)
```

## Plot 2 Approach

## Plot 2 Discussion

## Plot 2 Limitations and Future Study

## Question 1 Conclusion

## Question 2 {background-color = "lightgray"}

## Plot 1

## Plot 1 Approach

## Plot 1 Discussion

## Plot 1 Limitations and Future Study

## Plot 2

```{r load-merge-and-process-data-for-plot-2, echo=FALSE, warning=FALSE}
corp_by_politician <-
  readr::read_csv(
    "https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-06-07/corp_by_politician.csv"
  )
static_list <- readRDS("data/static_list.RDS")
contribution_data_all_states <-
  readRDS("data/contribution_data_all_states.RDS")

question2_data <-
  inner_join(contribution_data_all_states, corp_by_politician, by = "Politician")
# inner join to capture the politicians that appear in both datasets

question2_plot2_data <- question2_data %>%
  filter(!is.na(Date)) %>%
  mutate(year = year(ymd(Date))) %>%
  mutate(is_greg = ifelse(Politician == "Greg Abbott", "Greg Abbott", "Not Greg Abbott")) %>%
  filter(year == 2019 | year == 2020 | year == 2021 | year == 2022)

# question2_data %>% filter(Politician == "Greg Abbott") %>% select(year) %>% unique()
# Greg only had data in years 2019-2022 so we consider only those years
```

```{r plot-4-more-data-processing-for-plot, echo=FALSE, warning=FALSE}
greg_not_greg <- question2_plot2_data %>%
  group_by(is_greg, year) %>%
  summarise(
    amounts = sum(Amount),
    .groups = "drop"
  )

greg <- greg_not_greg %>%
  filter(is_greg == "Greg Abbott")

props_greg_not_greg <- greg_not_greg %>%
  group_by(year) %>%
  summarise(
    prop = round(100 * (amounts / sum(amounts)), 0),
    .groups = "drop"
  )

total_amount_per_year <- greg_not_greg %>%
  group_by(year) %>%
  summarise(
    amount_sum = sum(amounts),
    .groups = "drop"
  )

annotation_data_2019 <- tribble(
  ~amount_min,
  ~amount_max,
  ~percentage,
  ~color,
  0,
  greg$amounts[1],
  paste0(props_greg_not_greg$prop[1], "%"),
  "white",
  greg$amounts[1],
  total_amount_per_year$amount_sum[1],
  paste0(props_greg_not_greg$prop[2], "%"),
  "black"
) %>%
  mutate(amount_mid = (amount_min + amount_max) / 2)

annotation_data_2020 <- tribble(
  ~amount_min,
  ~amount_max,
  ~percentage,
  ~color,
  0,
  greg$amounts[2],
  paste0(props_greg_not_greg$prop[3], "%"),
  "white",
  greg$amounts[2],
  total_amount_per_year$amount_sum[2],
  paste0(props_greg_not_greg$prop[4], "%"),
  "black"
) %>%
  mutate(amount_mid = (amount_min + amount_max) / 2)

annotation_data_2021 <- tribble(
  ~amount_min,
  ~amount_max,
  ~percentage,
  ~color,
  0,
  greg$amounts[3],
  paste0(props_greg_not_greg$prop[5], "%"),
  "white",
  greg$amounts[3],
  total_amount_per_year$amount_sum[3],
  paste0(props_greg_not_greg$prop[6], "%"),
  "black"
) %>%
  mutate(amount_mid = (amount_min + amount_max) / 2)

annotation_data_2022 <- tribble(
  ~amount_min,
  ~amount_max,
  ~percentage,
  ~color,
  0,
  greg$amounts[4],
  paste0(props_greg_not_greg$prop[7], "%"),
  "white",
  greg$amounts[4],
  total_amount_per_year$amount_sum[4],
  paste0(props_greg_not_greg$prop[8], "%"),
  "black"
) %>%
  mutate(amount_mid = (amount_min + amount_max) / 2)
```

```{r plot-4, echo=FALSE, warning=FALSE}
ggplot(greg_not_greg) +
  geom_bar(aes(
    x = year,
    y = amounts,
    fill = fct_relevel(factor(
      is_greg, levels = c("Not Greg Abbott", "Greg Abbott")
    ))
  ),
  position = "stack",
  stat = "identity") +
  geom_text(
    data = annotation_data_2019,
    aes(
      x = 2019,
      y = amount_mid,
      label = percentage,
      color = color
    ),
    size = 3
  ) +
  geom_text(
    data = annotation_data_2020,
    aes(
      x = 2020,
      y = amount_mid,
      label = percentage,
      color = color
    ),
    size = 3
  ) +
  geom_text(
    data = annotation_data_2021,
    aes(
      x = 2021,
      y = amount_mid,
      label = percentage,
      color = color
    ),
    size = 3
  ) +
  geom_text(
    data = annotation_data_2022,
    aes(
      x = 2022,
      y = amount_mid,
      label = percentage,
      color = color
    ),
    size = 3
  ) +
  scale_color_identity() +
  labs(
    x = "Year", y = "Amount Donated for anti-LGBTQ+ Campaigns
       (in USD)",
    fill = "Politician",
    title = "Distribution of donation amounts for anti-LGBTQ+ politicians",
    subtitle = "In the years 2019-2022"
  ) +
  scale_fill_manual(values = c("lightgrey", "#AA4A44")) +
  scale_y_continuous(
    limits = c(0, 11000000),
    labels = scales::label_dollar(),
    breaks = c(0, 2000000, 4000000, 6000000, 8000000, 10000000)
  ) +
  theme_minimal() +
  theme(
    legend.position = c(0.12, 0.85),
    legend.background = element_blank(),
    legend.box.background = element_rect(color = "darkgrey", size = 0.5)
  )
```

## Plot 2 Approach
        
* Goal: examine how the total amount contributed to anti-LGBTQ+ politicians changed over time

* Methodology: stacked bar plot with year on the x axis and total amount of contributions on the y axis
    - Colored by Greg Abbott vs. all the other politicians except Abbott
    - Annotations for the different proportions (in %) for better interpretability

## Plot 2 Discussion 

* Increase in total amounts donated to anti-LGBTQ+ politicians in 2019-2021
    - Stark increase in 2021; total amounts decreased significantly in 2022

* The proportion (and dollar amount) of total donations going to Greg Abbott increased in 2019-2021
    - Abbott had over 60% of total donations in 2021

* In 2022, Abbott received a smaller proportion of total donations and a smaller dollar amount of donations

## Plot 2 Limitations and Future Study 

* Dataset only includes information on six states: Florida, Texas, Idaho, Alabama, Arizona, and Tennessee

* Our research would've been stronger had there been information on more states so we could compare between Republican and Democratic politicians
    - Would also be interesting to look into federal politicians

## Question 2 Conclusion

## Sources
